 // This helper function can be moved outside of your component
 // to prevent it from being recreated on every render.
 const parseFile = async (file, apiUrl) => {
  const formData = new FormData();
  formData.append('file', file);
  const response = await fetch(`${apiUrl}/parse`, {
    method: 'POST',
    body: formData,
  });
  if (!response.ok) {
    const err = await response.json();
    throw new Error(`Error parsing ${file.name}: ${err.error || response.statusText}`);
  }
  return response.json();
};

  const handleParseFiles = async (file1, file2) => {
    if (!file1 && !file2) {
      setStatus("Please select at least one file.");
      return;
    }

    // 1. Set the loading state
    setIsLoading(true);
    setStatus("Uploading and parsing... Please wait.");
    setFile1Data(null);
    setFile2Data(null);

    // 2. Try to parse files
    try {
      // Using Promise.all with this structure is a bit more robust
      // and scales better if you were to add more file inputs.
      const [result1, result2] = await Promise.all([
        file1 ? parseFile(file1, API_URL) : Promise.resolve(null),
        file2 ? parseFile(file2, API_URL) : Promise.resolve(null),
      ]);

      // 3. Set the data state
      if (file1) setFile1Data(result1);
      if (file2) setFile2Data(result2);
      setStatus("Parse complete! Charts updated.");
      
    } catch (error) {
      console.error("Error:", error);
      setStatus(`An error occurred: ${error.message}`);
    } finally {
      // 4. Turn off loading state (no matter what)
      setIsLoading(false);
    }
  };